{% extends 'app/base.html' %}
{% load static %}

{% block content %}
<style>
    .booking_background{
        width: 100%;
        height: 110vh;
        background-image: url('{% static 'assets/img/background/room.jpg' %}');
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
    }

    .booking_section{
        z-index: 2;
        width: 100%;
        margin-top: 10px;
        border-radius: 5px;
        background: #FFFFFF;
        border: solid 1px #eeeeee;
        
        top: 50%;
        left: 50%;
        position: absolute;
        -ms-transform: translateX(-50%) translateY(-50%);
        -webkit-transform: translate(-50%,-50%);
        transform: translate(-50%,-50%);
    }

    .form-row{
        margin-left: auto;
        margin-right: auto;
    }
</style>

<div class="row">
    <div class="col-lg-12 ">                   
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10 ">
                <!-- begin booking title -->
                <div class="row">
                    <div class="col-md-12" style="text-align: center;">
                        <h2 text>Book Room</h2>
                    </div>
                </div>
                <!-- end booking title -->

                <!-- begin guest details -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="portlet-body form">
                            <!-- Begin Form -->
                            <!-- <form method="POST"> -->
                                
                                <div class="form-body">
                                    <!-- <div class="row">
                                        <div class="col-md-12">
                                            <h4> Guest Infromation</h4>                                            
                                        </div>                                    
                                    </div> -->
                                    <div class="row">
                                            <div class="col-md-6">
                                                <div class="card">
                                                    <div class="card-body">     
                                                        <h4> Guest Information</h4>                                                   
                                                        <address class="mb-0 font-14 address-lg">
                                                            <abbr title=""><b>Name:</b></abbr> {{guest.title}} {{guest.first_name}} {{guest.middle_name}} {{guest.last_name}}  <br />
                                                            <abbr title=""><b>ID/Passport No:</b></abbr> {{guest.id_document_number}} <br />
                                                            <abbr title=""><b>Email Address:</b></abbr> {{guest.email}} <br />
                                                            <abbr title=""><b>Address:</b></abbr> {{guest.address}} <br />
                                                            <abbr title=""><b>Area Code:</b></abbr> {{guest.area_code}} <br />
                                                            <abbr title=""><b>Town:</b></abbr> {{guest.town}} <br />
                                                            <abbr title=""><b>Phone Number:</b></abbr> {{guest.phone_number}} <br />                                                            
                                                            <br>
                                                        </address>                                                        
                                                    </div>
                    
                                                    <div class="process-line" style="width: 33%;"></div>
                                                </div>                                           
                                            </div>
                                            <br>
                                            <div class="col-md-6">
                                                <div class="card">
                                                    <div class="card-body">     
                                                        <h4> Guest Information</h4>                                                   
                                                        <address class="mb-0 font-14 address-lg">
                                                            <abbr title=""><b>Gender:</b></abbr> {{guest.gender}} <br />
                                                            <abbr title=""><b>Date of Birth:</b></abbr> {{guest.dob}} <br />
                                                            <abbr title=""><b>Religion:</b></abbr> {{guest.religion}} <br />
                                                            <abbr title=""><b>Marital Status:</b></abbr> {{guest.marital_status}} <br />
                                                            <abbr title=""><b>Nationality:</b></abbr> {{guest.nationality}} <br />
                                                            <abbr title=""><b>Residency:</b></abbr> {{guest.residency}} <br />  
                                                            <br>
                                                        </address>                                                        
                                                    </div>
                    
                                                    <div class="process-line" style="width: 33%;"></div>
                                                </div>                                           
                                            </div>
                                            
                                            <hr>
                                            {% for reservation in reservation_response %}
                                            <div class="col-md-12" style="margin-top: 10px;">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h4> Reservation Information</h4>    
                                                        <address class="mb-0 font-14 address-lg">
                                                            
                                                            <abbr title=""><b>From:</b></abbr> {{reservation.date_from}} <br />
                                                            <abbr title=""><b>To:</b></abbr> {{reservation.date_to}} <br />
                                                            <abbr title=""><b>Amount Paid:</b></abbr> {{reservation.amount_paid}} <br />                                                            
                                                            <abbr title=""><b>Religious Book:</b></abbr> {{reservation.religious_book}} <br />                                                                                                                                                                  
                                                        </address>
                                                        
                                                    </div>
                    
                                                    <div class="process-line" style="width: 33%;"></div>
                                                </div>                                                
                                                
                                            </div>
                                            {% endfor %}
                                            
                                    </div>

                                    <br>

                                    <!-- Begin Room Preference -->
                                    
                                    
                                    
                                    <!-- End Room Preference -->

                                </div>
                            <!-- </form> -->
                            <!-- End Form -->
                        </div>
                    </div>
                </div>
                <!-- end guest details -->
                <br>
                <!-- begin available rooms -->                
                                 
                <!-- end available rooms -->                
            </div>
        </div>
    </div>
</div>

<script src="{% static 'assets/global/plugins/jquery.min.js' %}" type="text/javascript"></script>
<script>
    $(document).ready(function(){
        let geust_uid = document.getElementById("guest_uid");
        let room_view = document.getElementById("room_view");
        let room_type = document.getElementById("room_type");
        let room_scent = document.getElementById("room_scent");
        let room_light = document.getElementById("room_light");
        let room_humidity = document.getElementById("room_humidity");
        let room_temprature = document.getElementById("room_temprature");
        
        
       
        $('#submit').click(function(event){
            event.preventDefault();
            let checkedValues = [];   
            let guest_uid_value = geust_uid.value;
            let room_type_value = room_type.value;
            let room_view_value = room_view.value;
            let room_scent_value = room_scent.value;
            let room_light_value = room_light.value;
            let room_humidity_value = room_humidity.value;
            let room_temprature_value = room_temprature.value;
            const checkboxes = document.querySelectorAll('input[name="checks"]:checked');
            
            // loop through checkboxes and add checked values to array
            checkboxes.forEach(function(checkbox) {
                checkedValues.push(checkbox.value);
            });

            console.log("Checkoboxes", checkedValues);
            
            $.ajax({
                type: 'POST',
                url: "{% url 'filter-rooms' %}",
                data: {       
                    "checked_values": checkedValues,
                    "room_type_value": room_type_value,
                    "room_view_value": room_view_value,
                    "room_scent_value": room_scent_value,
                    "room_light_value": room_light_value,
                    "room_humidity_value": room_humidity_value,
                    "room_temprature_value": room_temprature_value,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },

                success: function (response) {                                                                                            
                    let raw_query_field = document.getElementById("raw_query");
                    let available_rooms = document.getElementById("available_rooms");
                    
                    var raw_query = response.raw_query;
                    var roomResponse = response.room_response;
                    var html = '';
                    
                    for (var i = 0; i < roomResponse.length; i++) {
                        var item = roomResponse[i];                        
                        html += '<div class="form-group col-md-1">';
                        html += '<div class="row">';
                        html += '<div class="col-md-1 ">';
                        html += '<a href="/booking/room/'+ guest_uid_value +'/'+ item.uid +'" class="btn btn-primary">'+ item.room_number + ' </a>';
                        html += '</div>';
                        // html += '<div class="col-md-10"><input type="radio" class="col-md-2" value="' + item.uid + '" name="selected_room"></div>';
                        html += '</div>';
                        html += '</div>';                        
                    }

                    $('#available_rooms').html(html);
                    // raw_query_field.value = raw_query;

                },

            });

        });
        
    });
</script>
{% endblock %}

