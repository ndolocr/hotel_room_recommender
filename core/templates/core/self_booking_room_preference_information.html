{% extends 'app/base.html' %}
{% load static %}

{% block content %}
<style>
    .booking_background{
        width: 100%;
        height: 150vh;
        background-image: url('{% static 'assets/img/background/room.jpg' %}');
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
    }

    .booking_section{
        z-index: 2;
        width: 100%;
        margin-top: 10px;
        border-radius: 5px;
        background: #FFFFFF;
        border: solid 1px #eeeeee;
        
        top: 50%;
        left: 50%;
        position: absolute;
        -ms-transform: translateX(-50%) translateY(-50%);
        -webkit-transform: translate(-50%,-50%);
        transform: translate(-50%,-50%);
    }

    .form-row{
        margin-left: auto;
        margin-right: auto;
    }
</style>

<div class="row">
    <div class="col-lg-12 booking_background">                   
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10 booking_section">
                <!-- begin booking title -->
                <div class="row">
                    <div class="col-md-12" style="background: #eeeeee; padding: 5px; margin-bottom: 10px;">
                        <h4 text>Room Preferences</h4>
                    </div>
                </div>
                <!-- end booking title -->

                <!-- begin guest details -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="portlet-body form">
                            <!-- Begin Form -->
                            <!-- <form method="POST"> -->
                                
                                <div class="form-body">
                                    <!-- <div class="row">
                                        <div class="col-md-12">
                                            <h4> Guest Infromation</h4>                                            
                                        </div>                                    
                                    </div> -->
                                    <div class="row">
                                            <div class="col-md-6">
                                                <div class="card">
                                                    <div class="card-body">                                                        
                                                        <address class="mb-0 font-14 address-lg">
                                                            <abbr title=""><b>{{guest.title}} .</b></abbr> {{guest.first_name}} {{guest.middle_name}} {{guest.last_name}}  <br />
                                                            <abbr title=""><b> <i class="fa fa-mosque" ></i> </b></abbr> {{guest.religion}} <br />                                                            
                                                            <abbr title=""><b> <i class="fa fa-envelope" ></i> </b></abbr> {{guest.email}} <br />                                                            
                                                        </address>
                                                        <input type="text" hidden value="{{guest.uid}}" name="guest_uid" id="guest_uid">
                                                    </div>
                    
                                                    <div class="process-line" style="width: 33%;"></div>
                                                </div>                                           
                                            </div>

                                            <div class="col-md-6">
                                                <div class="card">
                                                    <div class="card-body">                                                        
                                                        <address class="mb-0 font-14 address-lg">                                                                                                                        
                                                            <abbr title=""><b> <i class="fa fa-address-card"></i> </b></abbr> {{guest.address}} - {{guest.area_code}} <br />                                                    
                                                            <abbr title=""><b> <i class="fa fa-location-dot"></i> </b></abbr> {{guest.town}} <br />
                                                            <abbr title=""><b> <i class="fa fa-earth-americas" ></i> </b></abbr> {{guest.nationality}} <br /> 
                                                        </address>
                                                        <input type="text" hidden value="{{guest.uid}}" name="guest_uid" id="guest_uid">
                                                    </div>
                    
                                                    <div class="process-line" style="width: 33%;"></div>
                                                </div>                                           
                                            </div>
                                    </div>

                                    <br>

                                    <!-- begin query -->
                                    <div class="col-md-12" >
                                        <div class="form-group">
                                            <div class="input-group">
                                                <input type="text" class="form-control" name="txtQuery" id="txtQuery">
                                            </div>
                                        </div>
                                    </div>
                                    <!-- end query -->

                                    <!-- Begin Room Preference -->
                                    
                                        
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-12" style="background: #eeeeee; padding: 5px; margin-bottom: 10px;">
                                                    <h5>Room Information</h5>
                                                </div>
                                                <!-- begin room type-->
                                                <div class="form-group col-md-4">
                                                    <!-- <label>Room Type</label> -->
                                                    <div class="input-group">
                                                        <select id="room_type" name="room_type" class="select2 form-control">
                                                            <option value="" selected disabled hidden>
                                                                Room Type
                                                            </option>
                                                            {% for room_type in room_type_response %}
                                                            <option value="{{room_type.uid}}"> {{room_type.name}} </option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                                <!-- end room type-->

                                                <!-- begin view preference-->
                                                <div class="form-group col-md-4">
                                                    <!-- <label>Room View Preference</label> -->
                                                    <div class="input-group">
                                                        <select id="room_view" name="room_view" class="select2 form-control">
                                                            <option value="" selected disabled hidden>
                                                                Room View
                                                            </option>
                                                            {% for view in room_view_response %}

                                                            <option value="{{view.uid}}"> {{view.name}}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                                <!-- end view preference-->

                                                <!-- begin room scent-->
                                                <div class="form-group col-md-4">
                                                    <!-- <label>Room Scent</label> -->
                                                    <div class="input-group">
                                                        <select id="room_scent" name="room_scent" class="select2 form-control">
                                                            <option value="" selected disabled hidden>
                                                                Room Scent
                                                            </option>
                                                            {% for scent in room_scent_response %}
                                                            <option value="{{scent.uid}}"> {{scent.scent_name}} </option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                                <!-- end room scent-->

                                                <!-- begin room access-->
                                                <div class="col-md-4">                                        
                                                    <div class="input-group">
                                                        <select id="room_access" name="room_access" class="select2 form-control">
                                                            <option value="" selected disabled hidden>
                                                                Room Accessibility
                                                            </option>
                                                            {% for access in room_access_response %}
                                                            <option value="{{access.uid}}"> {{access.accessibility_name}} </option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                                <!-- end room access-->

                                                <!-- begin date from-->
                                                <div class="col-md-4">                                        
                                                    <div class="input-group">
                                                        <label style="margin-right: .2rem; border: solid #ced4da 1px; border-radius: .25rem; line-height: 1.5; font-weight: 400; font-size: 1rem; padding: .375rem .75rem; height: calc(1.5em + .75rem + 2px)">From</label>
                                                        <input type="date" class="form-control"  name="date_from" id="date_from">                                                        
                                                    </div>
                                                </div>
                                                <!-- end date from-->

                                                <!-- begin date to-->
                                                <div class="col-md-4">                                        
                                                    <div class="input-group">
                                                        <label style="margin-right: .2rem; border: solid #ced4da 1px; border-radius: .25rem; line-height: 1.5; font-weight: 400; font-size: 1rem; padding: .375rem .75rem; height: calc(1.5em + .75rem + 2px)">To</label>
                                                        <input type="date" class="form-control"  name="date_to" id="date_to">                                                        
                                                    </div>
                                                </div>
                                                <!-- end date to-->
                                                <div class="col-md-12">  
                                                    <hr>
                                                </div>
                                                <!-- begin room light-->
                                                <div class="form-group col-md-2">
                                                    <div class="input-group">
                                                        <input type="number" class="form-control" placeholder="Min Room Lighting" name="min_light" id="min_light">
                                                    </div>
                                                </div>

                                                <div class="form-group col-md-2">
                                                    <div class="input-group">
                                                        <input type="number" class="form-control" placeholder="Max Room Lighting" name="max_light" id="max_light">
                                                    </div>
                                                </div>
                                                <!-- end room light-->

                                                <!-- begin room humidity-->
                                                <div class="form-group col-md-2">
                                                    <div class="input-group">
                                                        <input type="number" class="form-control" placeholder="Min Room Humidity" name="min_humidity" id="min_humidity">
                                                    </div>
                                                </div>

                                                <div class="form-group col-md-2">
                                                    <div class="input-group">
                                                        <input type="number" class="form-control" placeholder="Max Room Humidity" name="max_humidity" id="max_humidity">
                                                    </div>
                                                </div>
                                                <!-- end room humidity-->

                                                <!-- begin room temprature-->
                                                <div class="form-group col-md-2">
                                                    <div class="input-group">
                                                        <input type="number" class="form-control" placeholder="Min Room Temprature" name="min_temprature" id="min_temprature">
                                                    </div>
                                                </div>

                                                <div class="form-group col-md-2">
                                                    <div class="input-group">
                                                        <input type="number" class="form-control" placeholder="Max Room Temprature" name="max_temprature" id="max_temprature">
                                                    </div>
                                                </div>
                                                <!-- end room temprature-->

                                                <!-- begin room elements -->
                                                <div class="col-md-12">
                                                    <hr>
                                                    <div class="row">
                                                        
                                                        <div class="col-md-12" style="background: #eeeeee; padding: 5px; margin-bottom: 10px;">
                                                            <h5>Guest Information</h5>
                                                        </div>

                                                        

                                                        <div class="form-group col-md-2">
                                                            <input type="text" class="form-control" placeholder="Number of Guests" name="num_of_guests">
                                                        </div>

                                                        <div class="form-group col-md-2">
                                                            <input type="text" class="form-control" placeholder="Guest illness" name="illness">
                                                        </div>
                                                        
                                                        <div class="form-group col-md-2">
                                                            <input type="text" class="form-control" placeholder="Customer Allergies" name="allergy">
                                                        </div>

                                                        <div class="form-group col-md-2">
                                                            <input type="text" class="form-control" placeholder="Pet type if any" name="pet_type">
                                                        </div>

                                                        <div class="form-group col-md-2">
                                                            <input type="text" class="form-control" placeholder="Number of pets" name="pet_num">
                                                        </div>
                                                        
                                                    </div>
                                                </div>                                                    
                                                <!-- end room elements -->   

                                                <!-- begin room elements -->
                                                <div class="col-md-12">
                                                    <hr>
                                                    <div class="row">
                                                        <div class="col-md-12" style="background: #eeeeee; padding: 5px; margin-bottom: 10px;">
                                                            <h5>Room Elements</h5>
                                                        </div>
                                                        
                                                        {% for item in room_elements_response %}
                                                            <div class="form-group col-md-2">
                                                                <!-- <label class="control-label">{{item.name}}</label>  -->
                                                                {{item.name}} - <input type="checkbox" class="col-md-2" value="{{item.uid}}" name="checks" />
                                                            </div>
                                                        {% endfor %}
                                                    </div>
                                                </div>                                                    
                                                <!-- end room elements -->
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- End Room Preference -->

                                </div>
                            <!-- </form> -->
                            <!-- End Form -->
                        </div>
                    </div>
                </div>
                <!-- end guest details -->
                <br>
                <!-- begin available rooms -->                
                    <div class="row" style="margin-bottom: 20px;">
                        <div class="col-md-12">

                            <div class="card">
                                <div class="card-body"> 
                                    <h5> Available Rooms </h5> 
                                    <p> Select a Room Number form available rooms.</p>                                   
                                    <div class="row" id="available_rooms">
                                        
                                                        
                                    </div>

                                    <div class="col-md-12">  
                                        <hr>
                                    </div>

                                    <!-- begin submit-->
                                    <div class="form-group col-md-3">                                                    
                                        <div class="input-group">
                                            <input type="submit" name="submit" id="submit" class="btn btn-primary" value="Book">
                                        </div>
                                    </div>
                                    <!-- end submit-->
                                </div>
                            </div>
                        </div>
                        
                    </div>                
                <!-- end available rooms -->                
            </div>
        </div>
    </div>
</div>

<script src="{% static 'assets/global/plugins/jquery.min.js' %}" type="text/javascript"></script>
<script>
    $(document).ready(function(){
        
        let date_to = document.getElementById("date_to");
        let date_from = document.getElementById("date_from");
        let min_light = document.getElementById("min_light");
        let max_light = document.getElementById("max_light");
        let guest_uid = document.getElementById("guest_uid");
        let room_view = document.getElementById("room_view");
        let room_type = document.getElementById("room_type");
        let room_scent = document.getElementById("room_scent");
        let room_access = document.getElementById("room_access");        
        let min_humidity = document.getElementById("min_humidity");
        let max_humidity = document.getElementById("max_humidity");
        let min_temprature = document.getElementById("min_temprature");
        let max_temprature = document.getElementById("max_temprature");
        

        let date_to_value = "";
        let date_from_value = "";
        let max_light_value = "";
        let min_light_value = "";
        let room_type_value = "";
        let room_view_value = "";
        let room_scent_value = "";
        let room_access_value = "";
        let min_humidity_value = "";
        let max_humidity_value = "";
        let min_temprature_value = "";
        let max_temprature_value = "";
        

        if (room_type != null) {
            room_type.addEventListener('change', function () {                
                room_type_value = room_type.value; 
                query_results();

            });
        }

        if (room_view != null) {
            room_view.addEventListener('change', function () {                
                room_view_value = room_view.value;
                query_results();
            });
        }

        if (room_scent != null) {
            room_scent.addEventListener('change', function () {                
                room_scent_value = room_scent.value;
                query_results();
            });
        }

        if (room_access != null) {
            room_access.addEventListener('change', function () {                
                room_access_value = room_access.value;
                query_results();
            });
        }

        if (date_to != null) {
            date_to.addEventListener('change', function () {                
                date_to_value = date_to.value;
            });
        }

        if (date_from != null) {
            date_from.addEventListener('change', function () {                
                date_from_value = date_from.value;
            });
        }
        
        if (max_light != null) {
            max_light.addEventListener('change', function () {                
                max_light_value = max_light.value;
                query_results();
            });
        }

        if (min_light != null) {
            min_light.addEventListener('change', function () {                
                min_light_value = min_light.value;
                query_results();
            });
        }
        
        if (min_humidity != null) {
            min_humidity.addEventListener('change', function () {                
                min_humidity_value = min_humidity.value;
                query_results();
            });
        }

        if (max_humidity != null) {
            max_humidity.addEventListener('change', function () {                
                max_humidity_value = max_humidity.value;
                query_results();
            });
        }

        if (min_temprature != null) {
            min_temprature.addEventListener('change', function () {                
                min_temprature_value = min_temprature.value;
                query_results();
            });
        }

        if (max_temprature != null) {
            max_temprature.addEventListener('change', function () {                
                max_temprature_value = max_temprature.value;
                query_results();
            });
        }

        function query_results(){          

            $.ajax({
                type: 'POST',
                url: "{% url 'filter-rooms' %}",
                data: {       
                    "date_to_value": date_to_value,
                    "date_from_value": date_from_value,
                    "max_light_value": max_light_value,
                    "min_light_value": min_light_value,
                    "room_type_value": room_type_value,
                    "room_view_value": room_view_value,
                    "room_scent_value": room_scent_value,
                    "room_access_value": room_access_value,
                    "min_humidity_value": min_humidity_value,
                    "max_humidity_value": max_humidity_value,
                    "min_temprature_value": min_temprature_value,
                    "max_temprature_value": max_temprature_value,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },

                success: function (response) {
                    let available_rooms = document.getElementById("available_rooms");
                    
                    var raw_query = response.raw_query;
                    var roomResponse = response.room_response;
                    var html = '';
                    
                    for (var i = 0; i < roomResponse.length; i++) {
                        var item = roomResponse[i];                        
                        html += '<div class="form-group col-md-2">';
                        html += 'Room '+ item.room_number +'- <input type="checkbox" class="col-md-2" value="' + item.uid + '" name="selected_room">';
                        html += '</div>';                      
                    }
                    available_rooms.innerHTML = html;
                    // $('#available_rooms').html(html);

                },
            });


        }
        
       
        $('#submit').click(function(event){
            event.preventDefault();
            let checkedValues = [];   
            let guest_uid_value = geust_uid.value;
            let room_type_value = room_type.value;
            let room_view_value = room_view.value;
            let room_scent_value = room_scent.value;
            let room_light_value = room_light.value;
            let room_humidity_value = room_humidity.value;
            let room_temprature_value = room_temprature.value;
            const checkboxes = document.querySelectorAll('input[name="checks"]:checked');
            
            // loop through checkboxes and add checked values to array
            checkboxes.forEach(function(checkbox) {
                checkedValues.push(checkbox.value);
            });

            console.log("Checkoboxes", checkedValues);
            
            $.ajax({
                type: 'POST',
                url: "{% url 'filter-rooms' %}",
                data: {       
                    "checked_values": checkedValues,
                    "room_type_value": room_type_value,
                    "room_view_value": room_view_value,
                    "room_scent_value": room_scent_value,
                    "room_light_value": room_light_value,
                    "room_humidity_value": room_humidity_value,
                    "room_temprature_value": room_temprature_value,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },

                success: function (response) {                                                                                            
                    let raw_query_field = document.getElementById("raw_query");
                    let available_rooms = document.getElementById("available_rooms");
                    
                    var raw_query = response.raw_query;
                    var roomResponse = response.room_response;
                    var html = '';
                    
                    for (var i = 0; i < roomResponse.length; i++) {
                        var item = roomResponse[i];                        
                        html += '<div class="form-group col-md-1">';
                        // html += '<div class="row">';
                        // html += '<div class="col-md-1 ">';
                        // html += '<a href="/booking/room/'+ guest_uid_value +'/'+ item.uid +'" class="btn btn-primary">'+ item.room_number + ' </a>';
                        // html += '</div>';
                        // // html += '<div class="col-md-10"><input type="radio" class="col-md-2" value="' + item.uid + '" name="selected_room"></div>';
                        // html += '</div>';
                        html += '</div>';                        
                    }

                    $('#available_rooms').html(html);
                    // raw_query_field.value = raw_query;

                },

            });

        });
        
    });
</script>
{% endblock %}

